# Telegram бот для подсчета кассы

Бот для учета наличных и безналичных средств в Telegram группах.

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Создайте файл `.env` на основе `.env.example` и укажите токен бота:
```
BOT_TOKEN=your_bot_token_here
```

3. Получите токен бота у [@BotFather](https://t.me/BotFather) в Telegram

## Запуск

### Обычный запуск (остановится при закрытии терминала):
```bash
python main.py
```

### Запуск в фоновом режиме (Windows):

**Вариант 1: Использование bat-файла**
- Дважды кликните `start_bot.bat` - бот запустится в фоне
- Для остановки используйте `stop_bot.bat`

**Вариант 2: Автозапуск при старте системы**
1. Запустите: `python run_bot_service.py install`
2. Скопируйте созданный файл `start_bot.vbs` в папку автозагрузки:
   - Нажмите `Win+R`
   - Введите `shell:startup`
   - Скопируйте туда `start_bot.vbs`

**Вариант 3: Ручной запуск в фоне**
```bash
start /min python main.py
```

**Остановка бота:**
```bash
taskkill /F /IM python.exe /FI "COMMANDLINE eq *main.py*"
```

### Развертывание на сервере (Linux):

**Быстрое развертывание:**
```bash
# 1. Загрузите файлы на сервер
# 2. Сделайте скрипты исполняемыми
chmod +x *.sh

# 3. Запустите развертывание
./deploy.sh

# 4. Создайте .env файл с токеном
nano .env  # Добавьте: BOT_TOKEN=your_token

# 5. Запустите бота
./start.sh
```

**Или установите как systemd службу (автозапуск):**
```bash
sudo ./install_service.sh
sudo systemctl start telegram-bot-casse
sudo systemctl enable telegram-bot-casse  # Автозапуск при загрузке
```

Подробные инструкции: см. [DEPLOY.md](DEPLOY.md)

## Использование

### Команды:
- `/start` - показать справку
- `/balance` - показать текущий баланс
- `/add` - добавить средства
- `/subtract` - вычесть средства
- `/history` - показать историю транзакций
- `/unit` - показать юнит-экономику
- `/categories` - управление категориями
- `/reset` - сбросить баланс (только для админов)

### Быстрый ввод:
Можно писать суммы прямо в чат:
- `+1000 нал` - добавить 1000 наличными
- `-500 карт` - вычесть 500 с карты
- `2000 нал` - добавить 2000 наличными
- `минус 300 карт` - вычесть 300 с карты

### Юнит-экономика:
- **Категории**: создавайте категории для организации транзакций (Кофе, Обеды, Товары и т.д.)
- **Количество и цена**: при добавлении транзакции указывайте:
  - `500 кол 5` - количество 5 единиц
  - `цена 100` - цена за единицу 100 ₽
  - `себест=50` - себестоимость 50 ₽
  - Полный пример: `500 кол 5 цена 100 себест=50`
- **Аналитика**: отслеживайте:
  - Выручку и прибыль по категориям
  - Маржу (процент прибыльности)
  - Средний чек и цену за единицу
  - Количество проданных единиц

## Особенности

- Работает в группах и личных чатах
- Хранит историю транзакций
- Раздельный учет наличных и безналичных средств
- Автоматическое распознавание сумм из текста
- **Юнит-экономика**: категории, метрики прибыльности, аналитика
- Защита команды сброса (только для админов)

