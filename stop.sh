#!/bin/bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

cd "$(dirname "$0")"

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞..."

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ PID —Ñ–∞–π–ª—É
if [ -f "bot.pid" ]; then
    PID=$(cat bot.pid)
    if ps -p $PID > /dev/null 2>&1; then
        echo "   –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (PID: $PID)..."
        kill $PID 2>/dev/null
        sleep 1
        # –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º
        if ps -p $PID > /dev/null 2>&1; then
            kill -9 $PID 2>/dev/null
        fi
        rm bot.pid
        echo "   ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "   ‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å —Å PID $PID –Ω–µ –Ω–∞–π–¥–µ–Ω"
        rm bot.pid
    fi
fi

# –ü–æ–∏—Å–∫ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ python3 main.py
PIDS=$(pgrep -f "python3 main.py" 2>/dev/null)
if [ ! -z "$PIDS" ]; then
    echo "   –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã python3 main.py, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é..."
    pkill -f "python3 main.py" 2>/dev/null
    sleep 1
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞, –µ—Å–ª–∏ –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç
    pkill -9 -f "python3 main.py" 2>/dev/null
    echo "   ‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
fi

echo "‚úÖ –ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

